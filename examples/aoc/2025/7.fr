
main :: fn() void = {
    s := import("@/lib/sys/fs.fr")'read_file_from_last_arg();
    s := s.split("\n", temp()).items();
    
    one := 0;
    range(0, s.len - 1) { y |
        range(0, s[0].len) { x |
            if s[y][x] == "S".ascii() {
                if s[y + 1][x] == ".".ascii() {
                    s[y + 1][x] = "S".ascii();
                };
                if s[y + 1][x] == "^".ascii() {
                    one += 1;
                    if x < s[0].len - 1 {
                        s[y + 1][x + 1] = "S".ascii();
                    }
                    if x > 0 {
                        s[y + 1][x - 1] = "S".ascii();
                    }
                };
            };
        };
    };
    
    memo: HashMap(i64, i64) = init(temp());
    i := s[0].index_of("S".ascii()).unwrap();
    two := follow(s, i, 0, memo&);
    
    @println("%\n%", one, two);
}

#use("@/lib/collections/map.fr");
follow :: fn(s: [][]u8, x: i64, y: i64, memo: *HashMap(i64, i64)) i64 = {
    @if(y >= s.len - 1) return(1);
    key := y * s[0].len + x;
    if(memo.get(key), fn(it) => return(it));
    
    if s[y + 1][x] != "^".ascii() {
        return follow(s, x, y + 1, memo);
    };
    
    result := 0
        + if(x > 0, => follow(s, x - 1, y + 1, memo), => 1)
        + if(x < s[0].len - 1, => follow(s, x + 1, y + 1, memo), => 1);
    memo.insert(key, result);
    result
}
