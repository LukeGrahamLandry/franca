
main :: fn() void = {
    s := import("@/lib/sys/fs.fr")'read_file_from_last_arg();
    s := s.split("\n", temp()).items();
    
    one := List(i64).list(temp());
    for s.slice(0, s.len - 1) { s |
        i := 0;
        j := 0;
        while => i < s.len {
            if s[i].is_ascii_digit() {
                n, remaining := convert_number_dyn(s.rest(i), 10);
                i = s.len - remaining.len;
                
                if one.len <= j {
                    one&.push(list(temp()));
                };
                col := one&.index(j); j += 1;
                col.push(n);
            } else {
                i += 1;
            };
        }
    };
    
    two := List(i64).list(temp());
    numbers := i64.list(temp());
    range(0, s[0].len) { x |
        value := 0;
        skip := 0;
        range(0, s.len) { y |
            c := @if(s[y].len <= x, " ".ascii(), s[y][x]);
            if c.is_ascii_digit() {
                value = value*10 + c.zext() - "0".char();
            } else {
                skip += 1;
            };
        };
        if skip == s.len {
            two&.push(numbers);
            numbers = i64.list(temp());
        } else {
            numbers&.push(value);
        };
    };
    two&.push(numbers);
    
    println(math(one, s));
    println(math(two, s));
}

math :: fn(columns: List(List(i64)), s: []Str) i64 = {
    result := 0;
    j := 0;
    for s[s.len - 1] { c |
        continue :: local_return;
        acc: (@FnPtr(a: i64, b: i64) i64) = @switch(c) {
            @case("*".ascii()) => mul;
            @case("+".ascii()) => add;
            @default => continue();
        };
        
        n := columns[j].items();
        j += 1;
        value := acc(n[0], n[1]);
        for n.rest(2) { n |
            value = acc(value, n);
        };
        result += value;
    };
    result
}
