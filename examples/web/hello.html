<style>
canvas:focus {
    outline: none;
}
</style>
<script type="module">
// THIS IS UNFINISHED
// TODO: the env imports call postMessage 
import * as FrancaGraphics from "../../graphics/web/app.js";
import { imports, handleWasmLoaded } from "./worker.js";
import { webgpu_wasm_exports, init_gpu } from "../../graphics/web/gfx.js";
let canvas = document.createElement("canvas");
document.body.style = "margin: 0;";
canvas.style = "border: 'none'; width:100%;height:100%;";
canvas.tabIndex = "1";  // this makes it focusable so it gets key events.
document.body.appendChild(canvas);
canvas.focus();

// TODO: i don't understand why you have to do this but it makes it not suck ass.
//       (its not the same as multiplying framebuffer_(w/h)
//        on the franca side because we don't pick the size of getcurrenttexture)
canvas.width = canvas.clientWidth * window.devicePixelRatio;
canvas.height = canvas.clientHeight * window.devicePixelRatio;

let w = await WebAssembly.instantiateStreaming(fetch("target/hello.wasm"), { 
    FrancaGraphics: FrancaGraphics, 
    webgpu: webgpu_wasm_exports,
    env: imports.env,
});
await init_gpu(w, canvas);
handleWasmLoaded(w, []);
</script>
