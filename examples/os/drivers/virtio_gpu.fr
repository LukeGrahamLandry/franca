CtrlType :: @enum(u32) (
       GetDisplayInfo = 0x0100,
     ResourceCreate2d = 0x0101,
        ResourceUnref = 0x0102,
           SetScanout = 0x0103,
        ResourceFlush = 0x0104,
     TransferToHost2d = 0x0105,
ResourceAttachBacking = 0x0106,
ResourceDetachBacking = 0x0107,
        GetCapsetInfo = 0x0108,
            GetCapset = 0x0109,
            
             OkNoData = 0x1100,
        OkDisplayInfo = 0x1101,
         OkCapsetInfo = 0x1102,
             OkCapset = 0x1103,
            ErrUnspec = 0x1200,
       ErrOutOfMemory = 0x1201,
  ErrInvalidScanoutId = 0x1202,
 ErrInvalidResourceId = 0x1203,
  ErrInvalidContextId = 0x1204,
  ErrInvalidParameter = 0x1205,
);

CtrlHdr :: @struct {
    type: CtrlType;
    flags: u32 = 0;
    fence_id: u64 = 0;
    ctx_id: u32 = 0;
    ring_idx: u8 = 0;
    _ := zeroed Array(u8, 3);
};

// "For any coordinates given 0,0 is top left, larger x moves right, larger y moves down."
Rect :: @struct(x: u32, y: u32, width: u32, height: u32);
Resource :: @struct(id: u32);

GetDisplayInfoOut :: @struct {
    pmodes: Array(Entry, 16);
    Entry :: @struct {
        r: Rect;
        enabled: u32;
        flags: u32;
    };
};

ResourceCreate2d :: @struct {
    resource: Resource;
    format: FormatUnorm;
    width: u32;
    height: u32;
};

FormatUnorm :: @enum(u32) (
    B8G8R8A8 = 1,
    B8G8R8X8 = 2,
    A8R8G8B8 = 3,
    X8R8G8B8 = 4,
    R8G8B8A8 = 67,
    X8B8G8R8 = 68,
    A8B8G8R8 = 121,
    R8G8B8X8 = 134,
);

ResourceUnref :: @struct {
    resource: Resource;
    _: u32 = 0;
};

SetScanout :: @struct {
    r: Rect;
    scanout_id: u32;
    resource: Resource;
};

ResourceFlush :: @struct {
    r: Rect;
    resource: Resource;
    _: u32 = 0;
};

TransferToHost2d :: @struct {
    r: Rect;
    offset: u64;
    resource: Resource;
    _: u32 = 0;
};

ResourceAttachBacking :: @struct {
    resource: Resource;
    nr_entries: u32;
    
    Entry :: @struct {
        addr: i64;  // physical!
        length: u32;
        _: u32 = 0;
    };
};

ResourceDetachBacking :: @struct {
    resource: Resource;
    _: u32 = 0;
};
