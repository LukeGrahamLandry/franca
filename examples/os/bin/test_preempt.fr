
main :: fn() void = { 
    data := true;
    t := bool.start_thread_data(data&) { (data: *bool) |
        println("B");
        usleep(100);
        println("C");
        data[] = false;
    };
    println("A");
    // busy wait so it only works if timer_irq preempts the parent to let the child run (when -smp 1). 
    dowhile(=> data);
    println("D");
    t.join();
}

#use("@/lib/sys/sync/atomics.fr", "@/lib/sys/threads.fr");
