
MContext :: @struct {
    gpr: Array(i64, 32);
    // why are we being interrupted?
    esr: i64;  // exception syndrome
    far: i64;  // fault address
    // how do we return after the interrupt?
    elr: i64;  // eret link register
    spsr: i64; // saved program status
    intid: i64;
    _: i64;
    //
    fpr: Array(i64, 64);
};

SignalHandler :: @struct {
    callee: @FnPtr(ctx: *MContext, intid: i64, data: i64) i64;
    stack: []u8;
};

fn set_signal_handler(new: SignalHandler) SignalHandler = {
    old := zeroed SignalHandler;
    args: Array(i64, 6) = (SignalHandler.int_from_ptr(new&), SignalHandler.int_from_ptr(old&), 0, 0, 0, 0);
    Syscall'perform_syscall(args&, 0xFFFF0003);  // sig_action
    old
}
