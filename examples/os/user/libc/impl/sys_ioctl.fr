
ioctl :: fn(f: Fd, op: i64, va: CVariadic) i64 /*#inline*/ = 
    FR_ioctl(f, op, va&.start().next(rawptr));

FR_ioctl :: fn(f: Fd, op: i64, data: rawptr) i64 = {
    fd := get_file(f) || return(-1);
    for fd.vtable.ioctls { n, callee |
        if n == op {
            return callee(fd.data, data);
        };
    };
    fd'vtable'ioctl(fd.data, op, data)
}

#use("@/lib/variadic.fr");
