#!/usr/bin/env franca
// Report which environment the compiler thinks you're targetting. 
// This is nice for testing that i can cross compile and run with rosetta2. 
// franca examples/default_driver.fr run examples/toy/where_am_i.fr -arch x86_64

main :: fn() = {
    @run @println("Comptime: % %", query_current_arch(), query_current_os());
    @run print_uname();
    @println("Runtime: % %", query_current_arch(), query_current_os());
    print_uname();
    #use("@/lib/sys/process.fr");
}

print_uname :: fn() void = {
    field_names :: @const_slice("sysname", "nodename", "release", "version", "machine");
    field_size := @if(query_current_os() == .linux, 65, 256);
    uname :: fn(buf: *u8) void #libc;  // TODO: #syscall(160, 63, _)
    // +1 for domainname on linux
    buf := temp().alloc_zeroed(u8, (field_names.len() + 1) * field_size);
    uname(buf.ptr);
    enumerate field_names { i, name |
        value: CStr = (ptr = buf.ptr.offset(i * field_size));
        @println("- %: %", name[], value);
    };
}
