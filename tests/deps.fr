// 
// The franca compiler itself is not allowed to depend on anything. 
// However, the example programs get more interesting without that restriction. 
// Listing these all in one place makes it easy to fetch them up front 
// and then run the tests in a sandbox without network access. 
// 

// "single-file public domain libraries for C/C++"
// font loader for examples/terminal
stb :: fn() = group(
    url = "https://github.com/nothings/stb/archive/f0569113c93ad095470c54bf34a17b36646bbbb5.zip", 
    legacy = "b62be3009cb9d4b6385bd4854bddf72d8e91f4e19d1347d6cf9589b19f70d45d",
    discard = @const_slice("data", "deprecated", "tests", "tools", "docs"),
);
// font data for examples/terminal
jetbrainsmono :: fn() = single(
    url = "https://github.com/JetBrains/JetBrainsMono/raw/cd5227bd1f61dff3bbd6c814ceaf7ffd95e947d9/fonts/ttf/JetBrainsMonoNL-Bold.ttf",
    hash = "0198e841824025f8876e5c297f0b9b497ee8d6eb9969710a3328e1303f996ec3",
    extract = (
        url = "https://download.jetbrains.com/fonts/JetBrainsMono-2.304.zip",
        legacy = "6f6376c6ed2960ea8a963cd7387ec9d76e3f629125bc33d1fdcd7eb7012f7bbf",
        path = "fonts/ttf/JetBrainsMonoNL-Bold.ttf", 
    ),
);
// "powerful, efficient, lightweight, embeddable scripting language"
// nontrivial test program for import_c
lua :: fn() = group(
    url = "https://www.lua.org/ftp/lua-5.4.7.tar.gz", 
    legacy = "9fbf5e28ef86c69858f6d3d34eccc32e911c1a28b4120ff3e84aaa70cfbf1e30",
);
// input for Lua (when testing import_c)
luatests :: fn() = group(
    url = "https://www.lua.org/tests/lua-5.4.7-tests.tar.gz", 
    legacy = "8a4898ffe4c7613c8009327a0722db7a41ef861d526c77c5b46114e59ebf811e",
);
// "memory-safe programming language (and a standard library written in that language) for Wrangling Untrusted File Formats Safely."
// test program for import_c
wuffs :: fn() = group(  // TODO: generated :(
    url = "https://github.com/google/wuffs/archive/b1174882799a6d39796a14c9b28fb4977144a480.zip", 
    legacy = "2725c410cd083fbd76740936a3310fe9dd1c022ce701655e3819123e6fa8339c",
    discard = @const_slice("cmd", "doc", "fuzz", "internal", "lang", "lib", "script", "snippet"),
);
// test programs for examples/lox
craftinginterpreters :: fn() = group(
    url = "https://github.com/munificent/craftinginterpreters/archive/4a840f70f69c6ddd17cfef4f6964f8e1bcd8c3d4.zip", 
    legacy = "c4c8a07244f778c4946358ffad0c047adad9819d15524568a07d98c1a6d73af1",
    discard = @const_slice("java", "site", "book", "asset", "note", "tool", "util", "c/clox.xcodeproj"),
);
// input for examples/prospero
// TODO: generate my own .vm programs from an sdf font instead 
fidget :: fn() = single(  
    url = "https://raw.githubusercontent.com/mkeeter/fidget/baef3e38653fc5deecd48b730ca0e234e6d01f79/models/prospero.vm",
    hash = "b93ab2d3240cf2c1ba271ee07ba1f238ebf93ac5b2cea29760e8ef9d7616562e",
    extract = (
        url = "https://github.com/mkeeter/fidget/archive/baef3e38653fc5deecd48b730ca0e234e6d01f79.zip", 
        legacy = "1224f8f982fe891e501c9d4a6aa0a4abb03e65022ee3118dccd7f17c2f3f7105",
        path = "models/prospero.vm",
    ),
);
// "c scripting everywhere - the smallest ansi c compiler"
// test program for import_c
tinycc :: fn() = group(
    url = "https://github.com/TinyCC/tinycc/archive/28d7fb85b25ad3667d1d2ca352173e214759d9e8.zip",
    legacy = "b66f0513b730d62b6ccc46decc038217cad830f28bdb6ae21a6e1a786a085d02",
    discard = @const_slice("win32", "tests/pp"),
);
// game to run on examples/os
doom :: fn() = group(
    url = "https://github.com/maximevince/fbDOOM/archive/72b0675c10f51ba5844df5669991c3ab7038fd1f.zip",
    legacy = "5dec861e2821301ce992b98872220c2acab08ac894bbb3c0a9c8424cc49890e2",
    discard = @const_slice("sndserv", "sersrc", "ipx"),
);
doomdata :: fn() = single(
    hash = "1d7d43be501e67d927e415e0b8f3e29c3bf33075e859721816f652a526cac771",
    extract = (
        url = "https://www.doomworld.com/3ddownloads/ports/shareware_doom_iwad.zip",
        legacy = "845f4f3a449343b068a4e178f9cb018cb1f5b7d5ef09db292864ed554f612276",
        path = "DOOM1.WAD",
    ),
);
// "a systems programming language designed to be simple, stable, and robust"
hare :: fn() = git(
    repo = "https://git.sr.ht/~sircmpwn/hare",
    commit = "e787c6f74c69d89530d542580c747a11e605ff8d",
    legacy = "17661d89d2a04e1c03551dcacf31284159cf7fe398159486fa4725d35775bf2c",
);
// "hare bootstrap compiler"
// it outputs qbe-ir so it works as a test for my backend. 
// test program for import_c
harec :: fn() = git(
    repo = "https://git.sr.ht/~sircmpwn/harec",
    commit = "8aa482a29964136cbe2874cd330fe07e34efe8a2",
    legacy = "0c4456f174ade789ef496f1462431a075ed10afde20aeb801c8f0a16ffa5cadd",
);
// 2017, before minic put "..." after every call, for reproducing queen.ssa
// test program for import_c
qbeminic :: fn() = git(
    repo = "git://c9x.me/qbe.git",
    commit = "d9f1121763c126316ab338ca8b1b9d51967a33b1",
    legacy = "7500a031910c6e4986a881fa48851bc8baca7a07de8efd229c352d02e837c702",
    discard = @const_slice("test", "tools", "doc"),
);
// for generating webgpu bindings. 
// TODO: don't depend on this
dawnjson :: fn() = single(
    url = "https://raw.githubusercontent.com/google/dawn/dfe3855e5d0b5367a598e60674766ffa1c894c71/src/dawn/dawn.json",
    hash = "bdf681b2c963d39f839b6590a25a739fa3a64f68ac9e0e8c0dc6d85f48c087ec", 
);
bubblewrap :: fn() = group(
    url = "https://github.com/containers/bubblewrap/archive/d6180f25b164c708b8b0a0d86d6a9642f30cd9a9.tar.gz",
    legacy = "781193d6c6ed4dfd4294ccf90d46b508b2c149132ab594da1debcf09f308e0d2",
);
wasmspec :: fn() = group(
    url = "https://github.com/WebAssembly/spec/archive/6e4c4bcaf7a4747f7a13623889727ee117550336.tar.gz", 
    legacy = "c525ed66f56e6b49b53e466beee2dd5af6dca905c84b3cc9caa609e5163db1da", 
    discard = @const_slice("document", "interpreter", "papers", "proposals", "specification", "spectec", "test/js-api"),
);
tracy :: @const_slice(
    "fetch",
    "https://github.com/wolfpld/tracy/archive/ec455c8ee634569447462af7bc42b8ac57b1dda7.zip",
    "6352360", "09176722dd58b134852be663ea07b2ed12088f702599e9fddf4ba176d4035809",
    "tracy-ec455c8ee634569447462af7bc42b8ac57b1dda7",
);

#use("@/examples/fetch.fr");

// i don't do anything special with these. 
// stylistic choice to be more verbose about things that depend on existing system state.

EXE :: @struct {
    clang :: "clang";  // gcc doesn't have -target (for cross compiling) or -ast-dump=json
    cc :: "cc";
    wast2json :: "wast2json";
    wasm_validate :: "wasm-validate";
    env :: "env";
    git :: "git";
    curl :: "curl";
    llvm_mc :: "llvm-mc";
    objdump :: "objdump";
    stockfish :: "stockfish";
};

PATH :: @struct {
    dev_null :: "/dev/null";
    proc_self_cmdline :: "/proc/self/cmdline";
    proc_self_exe :: "/proc/self/exe";
    tmp_perf_map :: "/tmp/perf-%.map";
    bin_sh :: "/bin/sh";
};

ENV :: @struct {
    GITHUB_REPOSITORY :: "GITHUB_REPOSITORY";
    FRANCA_TRACY :: "FRANCA_TRACY";
    FRANCA_LOG_STATS :: "FRANCA_LOG_STATS";
    FRANCA_PERFMAP :: "FRANCA_PERFMAP";
    FRANCA_TARGET_DIR :: "FRANCA_TARGET_DIR";
    FRANCA_BACKTRACE :: "FRANCA_BACKTRACE";
    FRANCA_NO_CACHE :: "FRANCA_NO_CACHE";
    FRANCA_DASH_J :: "FRANCA_DASH_J";
    FRANCA_MORE_CACHE :: "FRANCA_MORE_CACHE";
};
