# only valid when va_list is void* (arm64_apple, rv64, wasm)
function $print(l %fmt, ...) {
@start
    %ap =l alloc8 8
    storel 0, %ap
    vastart %ap  # loadopt wasn't treating this as a write
    %va_list_value =l load %ap
    call $vprintf(l %fmt, l %va_list_value)
    %bad =l load %ap
    %unused =l vaarg %ap
    %good =l load %ap
    call $vprintf(l %fmt, l %good)
    ret
}

data $fmt = { b "answer = %d\n" 0 }
export function l $main() {
@start
    call $print(l $fmt, ..., l 42, l 24)
    ret 0
}

# >>> output
# answer = 42
# answer = 24
# <<<
