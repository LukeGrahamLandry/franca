fn main(canary: i64) i64 = {

fn range(start: i64, end: i64, yield: Fn(i64, Unit)) Unit = {
    var i = start;
    (fn()=lt(i, end), fn()={  // TODO: fix vm poison when no brackets.
        yield(i);
        i = add(i, 1);
    })!while;
}

let zero = 0; // TODO: fully const arg

var sum = 0;
range(zero, 4, fn(i: i64) = {
    sum = add(sum, i);
});
assert_eq(sum, 6);

var sum = 0;
{
    let i: i64 <- range(zero, 4);
    sum = add(sum, i);
};
assert_eq(sum, 6);


canary
}