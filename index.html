<!doctype html>
<html lang="en">
    <head>
        <title>Franca Lang</title>
        <style type="text/css" media="screen">
            #editor {
                position: absolute;
                top: 0;
                right: 0;
                bottom: 0;
                left: 0;
                width: 60%;
            }
            #output {
                position: absolute;
                top: 0;
                right: 0;
                bottom: 0;
                width: 40%;
            }
        </style>
        <script
            src="https://cdn.jsdelivr.net/npm/ace-builds@1.32.6/src-noconflict/ace.js"
            integrity="sha256-q5o58HQ9mUZnWt31g9RRHsCGhG8ViDoyxa0kn4b4qLg="
            crossorigin="anonymous"
        ></script>
    </head>

    <body>
        <div id="editor">
            function foo(items) { var x = "All this is syntax highlighted";
            return x; }
        </div>
        <div id="output" style="background-color: gray">
            <div style="text-align: center">
                <button id="run" style="margin: 15px; font-size: 2rem">
                    Run
                </button>
            </div>
            <textarea
                id="log"
                style="
                    width: 100%;
                    height: 70%;
                    background-color: #1a202b;
                    outline: none;
                    color: white;
                "
            ></textarea>
        </div>
        <script type="module">
            window.editor = ace.edit("editor");
            editor.setTheme("ace/theme/monokai");
            editor.resize();
            const callbacks = { env: {} };
            if (
                typeof WebAssembly === "object" &&
                WebAssembly.instantiateStreaming !== undefined
            ) {
                WebAssembly.instantiateStreaming(
                    fetch("target/wasm32-unknown-unknown/release/franca.wasm"),
                    callbacks,
                ).then(handle_wasm_loaded);
            } else {
                alert("Your Browser No Wasm");
            }

            function handle_wasm_loaded(wasm) {
                let Rust = wasm.instance.exports;
                document.getElementById("run").addEventListener("click", () => {
                    console.log(editor.getValue());
                });
            }
        </script>
    </body>
</html>
