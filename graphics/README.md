# THIS IS NOT DONE
# MACOS-ARM64-METAL ONLY (for now)

Various things useful for creating cross platform graphical applications. 

- The cross platform part is still very much WIP
- Some example programs can be found in the franca examples folder. 
  - terminal, farm_game, mandebrot_ui, geo, app_events, depth_test

## Adapted from https://github.com/floooh/sokol

- gfx: 3D-API abstraction layer (platforms: Metal, wip: WebGPU)
- app: open a window, get a 3D-context, handle input events (platforms: MacOS)
- gl: OpenGL 1.x style immediate-mode rendering API
- debugtext: a simple ASCII text renderer using vintage home computer fonts

## My Additions

- shaders: translate a subset of franca to MSL/WGSL
- vec: 2/3/4-D linear algebra
- easy: reduce boilerplate for small example programs
- replay: record system events to a file and later replay that run of your program

## Changes from Sokol

### app

- removed builtin default app icon
- removed limits on paste/drop
- (macos) no dependency on an objective-c compiler
- (macos) wait until after setActivationPolicy to set the startup icon/fullscreen (otherwise it doesn't work)
- (macos) use CAMetalLayer directly (instead of MTKView)
- (macos) removed ios and opengl support (temporarily?)
- glue code for initializing webgpu native (dawn)
- UNFINISHED
  - don't have timing stuff (frame_duration)
  - only implemented for macos
  - (macos) msaa

### gfx

- generics are a surprise tool that can help us later
- removed the `query_*_(desc/info/____)` functions
- no limit for commit listeners. removing doesn't make holes in the array 
  so the order will be different. 
- (macos) no dependency on an objective-c compiler
- (macos) removed ios, opengl, and macos <13 support (temporarily?)
- UNFINISHED
  - webgpu
  - logging and trace hooks don't work
  - init(Attachments) 
  - compute shaders
  - validate Shader.Desc `_sg_validate_slot_bits`
  - shutdown (dealloc/deinit/fail resources)
  - move structs from bindings/sokol to here
  - clean up defaults
  - append/update buffer/image
  - only implemented for macos
  - (macos) im not setting labels

### debugtext

- remove printf-like functions. i don't like c-style varargs. can use @fmt into a temp buffer instead.
- caller manages the memory for the contexts but maybe that's annoying, idk
- remove byte array clutter. load font data from readable string (parsed at comptime). 
- removed the 8 font limit
- support non-square fonts so you can provide your own modern (monospace) fonts and use them with the same api

### gl

- caller manages the memory for the contexts but maybe that's annoying, idk
- allow recording vertices once and reusing them on future frames (while just changing uniforms). 

### all

- less code per code
- write shaders in franca instead of having byte arrays generated by an external program
- fewer global variables, always pass a context struct as the first parameter. 
this works nicely with how i use overloading as namespacing: `sgl_end()` becomes `sgl.end()` 
so the extra parameter isn't more verbose. 
- fewer getters/setters (just access fields directly). given im the only person that uses 
this language at the moment, i care more about having less code than a stable api. 
- removed assertions for things that feel like less of a problem in my language. 
  - enum values being in bounds
  - null pointer checks when they're immediately dereferenced anyway. 
  - canaries for uninitialized structs

## Tradeoffs vs Sokol

The main value of this code is the understanding I personally gained by typing it all out. 
Whether my changes are an improvement over the c version is a matter of personal preference. 
If you choose the c route, you can use `examples/c_bindgen.fr` to avoid manually typing ffi signetures. 

- They support multiple platforms. Currently I only support macos. 
- They have more example programs you can learn from. 
- They have better tests. I mostly just run an example program and see if it looks mostly ok. 
- They care more about providing a stable API. They have getters and setters for a bunch of fields that I let you access directly. 
- They make sure each library is an standalone header file you can include in your project. 
- They care about making it easy to write bindings in other languages. I'm making a franca library for franca programs. 

## Sokol License 

zlib/libpng license

Copyright (c) 2018 Andre Weissflog

This software is provided 'as-is', without any express or implied warranty.
In no event will the authors be held liable for any damages arising from the
use of this software.

Permission is granted to anyone to use this software for any purpose,
including commercial applications, and to alter it and redistribute it
freely, subject to the following restrictions:

    1. The origin of this software must not be misrepresented; you must not
    claim that you wrote the original software. If you use this software in a
    product, an acknowledgment in the product documentation would be
    appreciated but is not required.

    2. Altered source versions must be plainly marked as such, and must not
    be misrepresented as being the original software.

    3. This notice may not be removed or altered from any source
    distribution.